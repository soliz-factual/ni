ni('ni:/class/ni')->def(
  run => fn q{
    my $self = shift;
    shift, exit $self->$1(@_) if $_[0] =~ /^--(.*)$/ && $self->can($1);
    exit $self->default(@_);
  },

  'internal/image' => fn q{
    my $self = shift;
    my $q = ni('ni:/class/image')->new->partial_image(keys %ni::named);
    $q->quote($self);
    $q->write(\*STDOUT);
    0;
  });
