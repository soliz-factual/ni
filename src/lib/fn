ni->module('/lib/fn', code => <<'_');
use strict;
use warnings;
no strict 'refs';

*{'/class/fn::new'} = sub {
  my ($class, $code) = @_;
  my $fn = ni::eval "sub{$code\n}";
  die "ni:/class/fn failed to compile $code: $@\n" if $@;
  bless {code => $code, fn => $fn}, $class;
};

*{'/class/fn::(('}    = sub {};
*{'/class/fn::(&{}'}  = sub {shift->{fn}};
*{'/class/fn::(bool'} = sub {1};

sub fn($) {'/class/fn'->new(shift)}
_
